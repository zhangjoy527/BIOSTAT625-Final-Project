---
title: "625 Final Project Paper"
author: "Yeseul Ha, Joy Zhang, Jingyu Zhao"
date: "December 2023"
output: 
  pdf_document:
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(ggplot2)
diabetes_data <- read.csv("diabetes_data.csv")
```

# Introduction
Diabetes is a chronic disease that impacts 38 million adults in the United States, and it is a condition where the blood glucose levels are too high [3]. Diabetes is the eighth leading cause of death in the US and is categorized as either Type 1 or Type 2 diabetes. 90-95% of diabetes are Type 2, where the body is not capable of using insulin in the blood [2]. On the other hand, Type 1 diabetes consists of 5-10% of diabetes cases, and in this condition the body cannot produce its own insulin to use the blood glucose for energy [2]. Research has shown that high blood glucose is linked to other severe health problems, such as heart disease, nerve damage, and kidney disease [2]. The risk of diabetes has also been shown to drastically increase with age. According to the CDC, Type 2 diabetes develops most often in people over the age of 45 [3]. Some studies have even shown that after accounting for other health factors such as BMI, the ability for insulin to adjust blood glucose level continues to decreases with age, contributing to an increased risk of developing diabetes [6, 1]. In recent years, more young adults and adolescents are more developing Type II diabetes. In our research specifically, we would like to further examine the relationship between age and diabetes. 

To look at age as a predictor of diabetes, we decided to construct two models: the first being an unadjusted model with just age as a predictor, and the second being an adjusted model, adjusting for almost all other covariates in our data set. 

# Method
To begin examining our research question, we used a balanced dataset that was compiled and cleaned from the 2015 Behavioral Risk Factor Surveillance System (BRFSS) [8]. The BRFSS is an annual health-related telephone survey conducted by the CDC that gathers information on participants' health-related risk behaviors, chronic health conditions, and their engagement with preventative services. Our data contains 70,692 observations, with several health and background variables. Our diabetes outcome was binary with a value of 1 for individuals who are either diabetic or pre-diabetic, and 0 otherwise. 

## Data Cleaning
Before proceeding with our model construction, we chose to re-categorize certain categorical covariates for ease of interpretation. Age was originally a categorical covariate with 13 levels, however we re-coded the variable into 4 categories: Under 35, 35-49, 50-64, and over 64. Income was re-categorized into low income (less than \$25,000 a year), medium income (\$25,000 to \$75,000 a year), and high income (over \$75,000 a year). Education was transformed into a binary indicator with a 1 representing having a college education and a 0 representing no college education. Finally, physical and mental health covariates were also transformed into binary indicators, with a 1 representing 5 or more days of poor health, and 0 representing under 5 days. We chose 5 as a cutoff because it was right around the mean of our dataset. 

## Model Selection
Due to consistent research on the limitations of BMI as an effective health and obesity indicator, we decided to exclude BMI variable from our model [4, 5, 7]. This decision was based on the fact that BMI does not directly measure the body fat, and many factors including muscle and bone mass can influence the index. We also chose to exclude our General Health covariate, since our data set already included Physical Health and Mental Health and the General Health would be redundant and highly correlated to the previous two. 

A generalized linear model (GLM) with a logit link function was fitted in R using the `glm` package since our `Diabetes_binary` response, \(Y_i\), takes either 1 or 0 at the individual level. Observation pairs \( (x_i, Y_i) \) are independent. The GLM link function takes the following assumptions: for the systemic component, \( g(\pi_i) = \log\left(\frac{\pi_i}{1 - \pi_i}\right) = x_i^T \beta \) and for the random component, \( Y_i \sim \text{Binomial}(n_i, \pi_i) \). The mean function was \( \mu_i = \pi_i \) and the variance function was \( v(\pi_i) = \pi_i (1 - \pi_i) \). The first glm model we fit with just the age variable was $$logit(\pi_i) = \beta_0 + \beta_1 \cdot Age_{\{35-49\}} + \beta_2 \cdot Age_{\{50-65\}} + \beta_3 \cdot Age_{\{over 65\}}$$ with the reference age category as the age group of under 35 years old. Our second glm model with the rest of the selected covariates was $$\text{logit}(\pi_i) = \beta_0 + \beta_1 \cdot Age_{\{35-49\}} + \beta_2 \cdot Age_{\{50-65\}} + \beta_3 \cdot Age_{\{over 65\}} + \beta_4 \cdot HighBP_1 + \beta_5 \cdot HighChol_1 + \beta_6 \cdot CholCheck + \beta_7 \cdot Smoker_1 + \beta_8 \cdot Stroke_1 + \beta_9 \cdot HeartDiseaseorAttack_1 + \beta_{10} \cdot PhysActivity_1 + \beta_{11} \cdot Fruits_1 + \beta_{12} \cdot Veggies_1 + \beta_{13} \cdot HvyAlcoholConsump_1 + \beta_{14} \cdot AnyHealthcare_1 + \beta_{15} \cdot NoDocbcCost_1 + \beta_{16} \cdot High\_Physical\_Health + \beta_{17} \cdot High\_Mental\_Health + \beta_{18} \cdot DiffWalk_1 + \beta_{19} \cdot Male + \beta_{20} \cdot Medium\_Income + \beta_{21} \cdot High\_Income + \beta_{22} \cdot Edu\_College$$. The reference category for income was the low income group, and the reference category for education was chosen to be the no collefe education group. 

# Results

## Descriptive Statistics

Before examining our model results, we first created a couple of plots to look at the distribution of age among our covariates in our data set. We started by looking at our Diabetes response variable categorized by age, and saw that individuals with diabetes tend to be older than individuals without diabetes. 

```{r, echo=F, fig.dim = c(5, 3), fig.align='center'}
ggplot(diabetes_data) + 
  geom_bar(aes(x = Diabetes_binary, fill = factor(age_cat)), position = "fill") + 
  ggtitle("Diabetes Categorized by Age") + 
  labs(x = "Diabetes", y = "Proportion", fill = "Age Category") + 
  scale_fill_discrete(labels = c("Under 35", "36-49", "50-64", "Over 65"))
```

We also look at the distribution of age on its own and see that age appears to be left skewed, with more older individulas than younger. 

```{r, echo = F, fig.dim = c(5, 3), fig.align='center'}
ggplot(diabetes_data) + 
  geom_bar(aes(x = age_cat)) + 
  ggtitle("Distribution of Age") + 
  labs(x = "Age")
```

Finally, we chose to look at our predictor covariates categorized by age. While certain covariates such as smoking status and amount of fruits and veggies consumed did not have large differences in age breakdown, we found that most of our health indicators such as high blood pressure, high cholesterol, individuals who had experienced a stroke, and heart disease did have large discrepancies in age categories. All four plots suggested that groups of individuals suffering from the previously mentioned health disparities had higher percentages of older people commpared to those who did not suffer from the health disparities. 

```{r, echo = F, fig.dim = c(5, 3), fig.align='center'}
# Histogram of High Blood Pressure
BP_plot <- ggplot(diabetes_data) + 
  geom_bar(aes(x = factor(HighBP), fill = factor(age_cat)), position = "fill") +
  #ggtitle("High Blood Pressure") + 
  labs(x = "High Blood Pressure", y = "Proportion", fill = "Age Category") + 
  scale_fill_discrete(labels = c("Under 35", "36-49", "50-64", "Over 65"))

# Histogram of High Chloesterol
chol_plot <- ggplot(diabetes_data) + 
  geom_bar(aes(x = factor(HighChol), fill = factor(age_cat)), position = "fill") +
  #ggtitle("High Cholesterol Categorized by Age") + 
  labs(x = "High Cholesterol", y = "Proportion", fill = "Age Category") + 
  scale_fill_discrete(labels = c("Under 35", "36-49", "50-64", "Over 65"))

# Histogram of Smoking Status
smoker_plot <- ggplot(diabetes_data) + 
  geom_bar(aes(x = factor(Smoker), fill = factor(age_cat)), position = "fill") +
  #ggtitle("Smoking Status by Age") + 
  labs(x = "Smoking Status", y = "Proportion", fill = "Age Category") + 
  scale_fill_discrete(labels = c("Under 35", "36-49", "50-64", "Over 65"))

# Histogram of Stroke
stroke_plot <- ggplot(diabetes_data) + 
  geom_bar(aes(x = factor(Stroke), fill = factor(age_cat)), position = "fill") +
  #ggtitle("Stroke Categorized by Age") + 
  labs(x = "Stroke", y = "Proportion", fill = "Age Category") + 
  scale_fill_discrete(labels = c("Under 35", "36-49", "50-64", "Over 65"))

# Histogram of Heart Disease
heart_disease_plot <- ggplot(diabetes_data) + 
  geom_bar(aes(x = factor(HeartDiseaseorAttack), fill = factor(age_cat)), position = "fill") +
  #ggtitle("Heart Disease Categorized by Age") + 
  labs(x = "Heart Disease", y = "Proportion", fill = "Age Category") + 
  scale_fill_discrete(labels = c("Under 35", "36-49", "50-64", "Over 65"))

EDA_health <- ggarrange(BP_plot, chol_plot, stroke_plot, heart_disease_plot, common.legend = T, legend = "bottom")

annotate_figure(EDA_health, top = text_grob("Health Indicators Categorized by Age", 
               color = "black", face = "bold", size = 16))
```

This difference in age breakdown further interests us in our research question to see whether or not age is a significant predictor for diabetes. 

## Model Inference
Because our two models were nested, we were able to perform a likelihood ratio test to determine which one was a better fit. We found that our second model adjusting for all other covariates was superior to the one with just age as a predictor, and proceeded to interpret our results from the adjusted model summary.

**** needs more

## Model Diagnostics
To assess the goodness of fit of our model, Pearson Chi-Squared test was performed. In addition, a residual vs. fitted values plot, deviance residuals, a leverage plot and the Cook’s distance were examined to detect the influential point and the normality of residuals. Finally, the variance inflation factor (VIF) was calculated to check if multicollinearity issue exists. Results from these examinations suggested that our model provided a good fit to the data, with no evidence of major departures from the assumptions of the binomial distribution.

## RShiny Application
A secondary goal of our project was to create an application for not just our use, but for any researcher interested in the BRFSS data set. While we were specifically interested in diabetes as an outcome variable, the data set contains many other health indicators, such as high blood pressure, high cholesterol, heart disease, etc. In our RShiny application, users have the ability to select their specific covariate of interest, and build and analyze a model using the same methods we used. 

# Discussion

************* needs more

# References

[1] Boon How Chew et al. “Age 60years was an independent risk factor for diabetes-related complications despite good control of cardiovascular risk factors in patients with type 2 diabetes mellitus”. In: Experimental Gerontology 48.5 (May 2013), pp. 485–491. issn: 0531-5565. doi: 10.1016/j.exger.2013.02.017. url: http://dx.doi.org/10.1016/j.exger.2013.02.017.

[2] National Institute of Diabetes, Digestive, and Kidney Diseases. Diabetes Statistics. Feb. 2023. url: https://www.niddk.nih.gov/health-information/health-statistics/diabetes-statistics.

[3] Centers for Disease Control and Prevention. What is Diabetes. Sept. 5, 2023. url: https://www.cdc.gov/diabetes/basics/diabetes.html.

[4] Dong Hoon Lee et al. “Comparison of the association of predicted fat mass, body mass index, and other obesity indicators with type 2 diabetes risk: two large prospective studies in US men and women”. In: European Journal of Epidemiology 33.11 (Aug. 2018), pp. 1113–1123. issn: 1573-7284. doi: 10.1007/s10654-018-0433-5. url: http://dx.doi.org/10.1007/s10654-018-0433-5.

[5] Shriraam Mahadevan and Iftikhar Ali. “Is body mass index a good indicator of obesity?” In: International Journal of Diabetes in Developing Countries 36.2 (June 2016), pp. 140–142. issn: 1998-3832. doi: 10.1007/s13410-016-0506-5. url: http://dx.doi.org/10.1007/s13410-016-0506-5.

[6] K. Mordarska and M. Godziejewska-Zawada. “Diabetes in the elderly”. In: Prz Menopauzalny16.2 (June 2017), pp. 38–43.

[7] K. M. Narayan et al. “Effect of BMI on lifetime risk for diabetes in the U.S”. In: Diabetes Care 30.6 (June 2007), pp. 1562–1566.

[8] Alex Teboul. Diabetes Health Indicators Dataset. 2021. url: https://www.kaggle.com/datasets/alexteboul/diabetes-health-indicators-dataset/data.


